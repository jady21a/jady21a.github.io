<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>运动计时器 - 可暂停续计时</title>
<style>
  body {
      text-align: center;
      font-family: "Microsoft YaHei", Arial, sans-serif;
      background: linear-gradient(135deg, #f5f5f5, #e3f2fd);
      color: #333;
      margin: 0;
      padding: 20px;
  }
  h1 {
      margin-bottom: 10px;
  }
  #timer {
      font-size: 3em;
      margin: 20px;
      font-weight: bold;
  }
  #exercise {
      font-size: 2em;
      font-weight: bold;
      margin: 10px;
  }
  #exercise-image {
      max-width: 300px;
      height: auto;
      display: block;
      margin: 15px auto;
      border-radius: 10px;
      background: #fff;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  .controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
  }
  .controls button {
      font-size: 1.5em;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
  }
  #start {
      font-size: 2em;
      padding: 15px 30px;
      background-color: #28a745;
      color: white;
  }
  #start:hover {
      background-color: #218838;
  }
  #prev, #next {
      background-color: #007bff;
      color: white;
  }
  #prev:hover, #next:hover {
      background-color: #0056b3;
  }
  .time-info {
      display: flex;
      justify-content: space-between;
      font-size: 1.2em;
      margin-top: 20px;
      padding: 0 40px;
  }
</style>
</head>
<body>
<h1>运动计时器</h1>
<div id="exercise">点击开始按钮</div>
<img id="exercise-image" src="./img/0rest.png" alt="图片">
<div id="timer">准备就绪</div>
<div id="next-hint"></div>

<div class="time-info">
<span id="remaining-time">剩余时间: --</span>
<span id="total-duration">总时长: --</span>
</div>

<div class="controls">
<button id="prev">上一个</button>
<button id="start">开始</button>
<button id="next">下一个</button>
</div>

<script>
// beep 声音函数
function beep() {
    const context = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = context.createOscillator();
    const gainNode = context.createGain();
    oscillator.connect(gainNode);
    gainNode.connect(context.destination);
    oscillator.type = 'square';
    oscillator.frequency.value = 800;
    gainNode.gain.value = 0.2;
    oscillator.start();
    setTimeout(() => oscillator.stop(), 150);
}

const exercises = [
{ name: "头旋转", duration: 25, img: "./img/1头转动.gif" },
    { name: "耸肩", duration: 25 ,img:"./img/2耸肩.gif"},
    { name: "肩部环绕", duration: 25 ,img:"./img/3肩部环绕.gif"},
    { name: "肩部前后转", duration: 25 ,img:"./img/4肩膀前后转.gif"},
    { name: "仰天开合", duration: 25, img: "./img/5仰天开合.gif" },
    { name: "左右抬手", duration: 25, img: "./img/6左右抬手.gif" },
    { name: "抬头翘手", duration: 25, img: "./img/7抬头翘手.gif"  },
    { name: "外旋夹臂", duration: 25, img: "./img/8外旋夹臂.gif"  },
    { name: "下拉夹背", duration: 25, img: "./img/9下拉夹背.gif"  },
    { name: "上举开合", duration: 25, img: "./img/10上举开合.gif" },
    { name: "上下夹臂", duration: 25, img:"./img/11上下夹臂.gif"  },
    { name: "摆手", duration: 25, img: "./img/12摆手.gif" },
    { name: "右腿拉伸", duration: 17, img: "./img/13大腿拉伸.png" },
    { name: "左腿拉伸", duration: 17 ,img:"./img/13大腿拉伸.png" },
    { name: "左小腿拉伸", duration: 17, img:  "./img/14小腿拉伸.png"},
    { name: "右小腿拉伸", duration: 17 ,img:"./img/14小腿拉伸.png"},
    { name: "左侧肩后束拉伸", duration: 25, img:  "./img/15肩后束拉伸.png"},
    { name: "右侧肩后束拉伸", duration: 25 ,img:"./img/15肩后束拉伸.png"},
    { name: "扩胸运动", duration: 25 ,img:"./img/18扩胸.png" },
    { name: "纵横拉伸", duration: 25 ,img: "./img/17纵横拉伸.gif" },
    { name: "转体", duration: 25 ,img:"./img/19转体.png" }
];

const transitionTime = 1;
let totalDuration = exercises.reduce((sum, ex) => sum + ex.duration + transitionTime, -transitionTime);
let remainingTime = totalDuration;
let index = 0;
let interval;
let isRunning = false;
let timeLeft = 0; // 当前动作剩余时间

const exerciseName = document.getElementById("exercise");
const exerciseImage = document.getElementById("exercise-image");
const timerDisplay = document.getElementById("timer");
const remainingTimeDisplay = document.getElementById("remaining-time");
const totalTimeDisplay = document.getElementById("total-duration");
const startButton = document.getElementById("start");
const prevButton = document.getElementById("prev");
const nextButton = document.getElementById("next");
const nextHint = document.getElementById("next-hint");

function formatTime(sec) {
    return sec >= 60 ? `${Math.floor(sec/60)}分${sec%60}秒` : `${sec}秒`;
}

function updateExercise(idx) {
    const ex = exercises[idx];
    exerciseName.textContent = ex.name;
    exerciseImage.src = ex.img || "";
    timerDisplay.textContent = formatTime(timeLeft || ex.duration);
    nextHint.textContent = idx < exercises.length-1 ? `下一个动作：${exercises[idx+1].name}` : "最后一个动作";
}

// 启动/继续当前动作
function startExercise() {
    beep(); // 动作开始 beep
    if(timeLeft===0) timeLeft = exercises[index].duration; // 如果是第一次开始才赋值
    timerDisplay.textContent = formatTime(timeLeft);
    interval = setInterval(() => {
        timeLeft--;
        remainingTime--;
        timerDisplay.textContent = formatTime(timeLeft);
        remainingTimeDisplay.textContent = `剩余时间: ${formatTime(remainingTime)}`;
        if(timeLeft<=0){
            clearInterval(interval);
            beep(); // 动作结束 beep
            playNextExercise();
        }
    },1000);
}

// 自动播放下一个动作
function playNextExercise(){
    if(index < exercises.length-1){
        index++;
        timeLeft=0;
        updateExercise(index);
        setTimeout(startExercise, transitionTime*1000);
    }else{
        timerDisplay.textContent = "训练完成!";
        beep();
        setTimeout(resetWorkout, 1000);
    }
}

function resetWorkout(){
    clearInterval(interval);
    index=0;
    remainingTime=totalDuration;
    isRunning=false;
    timeLeft=0;
    startButton.textContent="开始";
    startButton.classList.remove("paused");
    exerciseName.textContent="点击开始按钮";
    exerciseImage.src="./img/0rest.png";
    timerDisplay.textContent="准备就绪";
    nextHint.textContent="";
    remainingTimeDisplay.textContent=`剩余时间: ${formatTime(remainingTime)}`;
}

// 切换开始/暂停
function toggleStart(){
    if(!isRunning){
        isRunning=true;
        startButton.textContent="暂停";
        startButton.classList.add("paused");
        updateExercise(index);
        startExercise();
    }else{
        isRunning=false;
        startButton.textContent="继续";
        startButton.classList.remove("paused");
        clearInterval(interval);
    }
}

// 手动下一/上一个动作
function nextManual(){
    if(index < exercises.length-1){
        clearInterval(interval);
        index++;
        timeLeft=0;
        updateExercise(index);
        beep();
        if(isRunning) startExercise();
    }
}

function prevManual(){
    if(index > 0){
        clearInterval(interval);
        index--;
        timeLeft=0;
        updateExercise(index);
        beep();
        if(isRunning) startExercise();
    }
}

totalTimeDisplay.textContent=`总时长: ${formatTime(totalDuration)}`;
remainingTimeDisplay.textContent=`剩余时间: ${formatTime(remainingTime)}`;

startButton.addEventListener("click", toggleStart);
nextButton.addEventListener("click", nextManual);
prevButton.addEventListener("click", prevManual);
</script>
</body>
</html>
