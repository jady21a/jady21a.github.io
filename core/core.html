<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Core 训练计时器</title>
    <script src="https://cdn.jsdelivr.net/npm/tone@14.7.58/build/Tone.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft YaHei", Arial, sans-serif;
            background: linear-gradient(135deg, #f5f5f5, #e3f2fd);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            width: 100%;
        }

        .image-section {
            text-align: center;
            margin-bottom: 8px;
        }

        .image-wrapper {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 16px;
            margin-bottom: 8px;
            max-width: 350px;
            margin-left: auto;
            margin-right: auto;
        }

        #exercise-image {
            width: 100%;
            height: 350px;
            object-fit: contain;
            border-radius: 8px;
        }

        #exercise-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1e293b;
            margin-top: 8px;
            margin-bottom: 4px;
        }

        #exercise-details {
            font-size: 1.125rem;
            color: #475569;
            margin-bottom: 4px;
        }

        #rep-counter {
            font-size: 1rem;
            color: #64748b;
            margin-bottom: 4px;
        }

        #rep-counter.hidden {
            display: none;
        }

        #next-exercise {
            font-size: 0.875rem;
            color: #64748b;
            margin-top: 8px;
        }

        .timer-section {
            text-align: center;
            margin: 0;
        }

        #current-timer {
            font-size: 3rem;
            font-weight: 700;
            color: #2563eb;
            font-variant-numeric: tabular-nums;
        }

        .control-panel {
            padding: 16px;
            max-width: 450px;
            margin: 0 auto;
        }

        .time-info {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 20px;
            text-align: center;
        }

        .time-info > div {
            display: flex;
            flex-direction: column;
        }

        .time-label {
            font-size: 0.75rem;
            color: #64748b;
            margin-bottom: 4px;
        }

        .time-value {
            font-size: 1.125rem;
            font-weight: 700;
            color: #334155;
            font-variant-numeric: tabular-nums;
        }

        .controls {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
}

.controls > div {
    display: flex;
    gap: 10px;
}

.controls button {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1em;
    font-weight: 600;
    transition: all 0.2s ease;
    background: #6c757d;
    color: white;
}

.controls button:hover {
    background: #5a6268;
}

#start {
    background: #007BFF;
    color: white;
    padding: 14px 32px;
    font-size: 1.2em;
}

#start:hover {
    background: #0056b3;
}

.back-btn {
    position: absolute;
    right: 0;
    padding: 8px;
    backdrop-filter: blur(10px);
    color: #333;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.back-btn:hover {
    background: white;
}

.back-btn svg {
    width: 24px;
    height: 24px;
}

        @media (max-width: 640px) {
            #exercise-image {
                height: 300px;
            }

            #exercise-name {
                font-size: 1.125rem;
            }

            #exercise-details {
                font-size: 1rem;
            }

            #current-timer {
                font-size: 2.5rem;
            }

            .control-panel {
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="image-section">
            <div class="image-wrapper">
                <img id="exercise-image" src="" alt="运动图片">
            </div>
            <h2 id="exercise-name"></h2>
            <p id="exercise-details"></p>
            <p id="rep-counter" class="hidden"></p>
            <p id="next-exercise">下一个: —</p>
        </div>

        <div class="timer-section">
            <div id="current-timer">00:00</div>
        </div>

        <div class="control-panel">
            <div class="time-info">
                <div>
                    <span class="time-label">剩余时长</span>
                    <span id="remaining-time" class="time-value">00:00</span>
                </div>
                <div>
                    <span class="time-label">总时长</span>
                    <span id="total-time" class="time-value">00:00</span>
                </div>
                <div>
                    <span class="time-label">动作进度</span>
                    <span id="exercise-progress" class="time-value">1 / 40</span>
                </div>
            </div>

            <div class="controls">
                <div style="display: flex; gap: 10px;">
                    <button id="prev">⏮</button>
                    <button id="start">▶</button>
                    <button id="next">⏭</button>
                </div>
                <a href="javascript:history.back()" class="back-btn">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z"/>
                    </svg>
                </a>
            </div>
        </div>
    </div>

    <script>
        const exercises = [
            { name: "猫式伸展", reps: 8, timePerRep: 9, duration: null, imageName: "a1Cat_Stretch.png", type: "reps" },
            { name: "跪姿左侧转体", reps: 6, timePerRep: 4.5, duration: null, imageName: "a2Kneeling Left Side Twist.png", type: "reps" },
            { name: "跪姿右侧转体", reps: 6, timePerRep: 4.5, duration: null, imageName: "a2Kneeling Left Side Twist.png", type: "reps" },
            { name: "休息", reps: null, timePerRep: null, duration: 4, imageName: "0rest.png", type: "rest" },
            { name: "臀桥", reps: 10, timePerRep: 5, duration: null, imageName: "a3Glute Bridge.png", type: "reps" },
            { name: "静态臀桥", reps: null, timePerRep: null, duration: 30, imageName: "a4Static Glute Bridge.png", type: "duration" },
            { name: "四点支撑", reps: null, timePerRep: null, duration: 30, imageName: "b1Quadruped Hold.png", type: "duration" },
            { name: "平板支撑", reps: null, timePerRep: null, duration: 30, imageName: "b2Plank.png", type: "duration" },
            { name: "休息", reps: null, timePerRep: null, duration: 7, imageName: "0rest.png", type: "rest" },
            { name: "仰卧交替对角伐木", reps: 12, timePerRep: 5, duration: null, imageName: "b3Supine Alternating Diagonal Woodchop.png", type: "reps", loop: 1 },
            { name: "简易俄罗斯转体", reps: 16, timePerRep: 2, duration: null, imageName: "b4Easy Russian Twist.png", type: "reps", loop: 1 },
            { name: "仰卧交替伸腿", reps: 12, timePerRep: 2, duration: null, imageName: "b5Supine Alternating Leg Extension.png", type: "reps", loop: 1 },
            { name: "休息", reps: null, timePerRep: null, duration: 10, imageName: "0rest.png", type: "rest", loop: 1 },
            { name: "平板支撑交替抬腿", reps: 12, timePerRep: 2.25, duration: null, imageName: "b5z1Plank with Alternating Leg Raise.png", type: "reps", loop: 1 },
            { name: "休息", reps: null, timePerRep: null, duration: 15, imageName: "0rest.png", type: "rest", loop: 1 },
            { name: "跪姿左侧后踢腿", reps: 12, timePerRep: 2.5, duration: null, imageName: "b7Kneeling Kickback.png", type: "reps", loop: 1 },
            { name: "跪姿右侧后踢腿", reps: 12, timePerRep: 2.5, duration: null, imageName: "b7Kneeling Kickback.png", type: "reps", loop: 1 },
            { name: "休息", reps: null, timePerRep: null, duration: 2, imageName: "0rest.png", type: "rest", loop: 1 },
            { name: "右侧屈膝侧支撑", reps: null, timePerRep: null, duration: 30, imageName: "b6Side Knee Bent Side Plank.png", type: "duration", loop: 1 },
            { name: "左侧屈膝侧支撑", reps: null, timePerRep: null, duration: 30, imageName: "b6Side Knee Bent Side Plank.png", type: "duration", loop: 1 },
            { name: "休息", reps: null, timePerRep: null, duration: 5, imageName: "0rest.png", type: "rest", loop: 1 },
            { name: "仰卧交替对角伐木", reps: 12, timePerRep: 5, duration: null, imageName: "b3Supine Alternating Diagonal Woodchop.png", type: "reps", loop: 2 },
            { name: "简易俄罗斯转体", reps: 16, timePerRep: 2, duration: null, imageName: "b4Easy Russian Twist.png", type: "reps", loop: 2 },
            { name: "仰卧交替伸腿", reps: 12, timePerRep: 2, duration: null, imageName: "b5Supine Alternating Leg Extension.png", type: "reps", loop: 2 },
            { name: "休息", reps: null, timePerRep: null, duration: 10, imageName: "0rest.png", type: "rest", loop: 2 },
            { name: "平板支撑交替抬腿", reps: 12, timePerRep: 2.25, duration: null, imageName: "b5z1Plank with Alternating Leg Raise.png", type: "reps", loop: 2 },
            { name: "休息", reps: null, timePerRep: null, duration: 15, imageName: "0rest.png", type: "rest", loop: 2 },
            { name: "跪姿左侧后踢腿", reps: 12, timePerRep: 2.5, duration: null, imageName: "b7Kneeling Kickback.png", type: "reps", loop: 2 },
            { name: "跪姿右侧后踢腿", reps: 12, timePerRep: 2.5, duration: null, imageName: "b7Kneeling Kickback.png", type: "reps", loop: 2 },
            { name: "休息", reps: null, timePerRep: null, duration: 2, imageName: "0rest.png", type: "rest", loop: 2 },
            { name: "右侧屈膝侧支撑", reps: null, timePerRep: null, duration: 30, imageName: "b6Side Knee Bent Side Plank.png", type: "duration", loop: 2 },
            { name: "左侧屈膝侧支撑", reps: null, timePerRep: null, duration: 30, imageName: "b6Side Knee Bent Side Plank.png", type: "duration", loop: 2 },
            { name: "休息", reps: null, timePerRep: null, duration: 8, imageName: "0rest.png", type: "rest", loop: 2 },
            { name: "平板支撑", reps: null, timePerRep: null, duration: 30, imageName: "b2Plank.png", type: "duration" },
            { name: "休息", reps: null, timePerRep: null, duration: 8, imageName: "0rest.png", type: "rest" },
            { name: "腹部拉伸", reps: null, timePerRep: null, duration: 30, imageName: "c1Abdominal Stretch.png", type: "duration" },
            { name: "跪姿背部拉伸", reps: null, timePerRep: null, duration: 40, imageName: "c2Kneeling Back Stretch.png", type: "duration" },
            { name: "站姿左侧拉伸", reps: null, timePerRep: null, duration: 40, imageName: "c3Standing Abdominal Stretch.png", type: "duration" },
            { name: "站姿右侧拉伸", reps: null, timePerRep: null, duration: 40, imageName: "c3Standing Abdominal Stretch.png", type: "duration" }
        ];
        
        const exerciseImage = document.getElementById('exercise-image');
        const exerciseName = document.getElementById('exercise-name');
        const exerciseDetails = document.getElementById('exercise-details');
        const repCounterEl = document.getElementById('rep-counter');
        const currentTimerEl = document.getElementById('current-timer');
        const remainingTimeEl = document.getElementById('remaining-time');
        const totalTimeEl = document.getElementById('total-time');
        const exerciseProgressEl = document.getElementById('exercise-progress');
        const prevBtn = document.getElementById('prev');
        const startPauseBtn = document.getElementById('start');
        const nextBtn = document.getElementById('next');

        const nextExerciseEl = document.getElementById('next-exercise');
        
        let currentExerciseIndex = 0;
        let currentExerciseTime = 0;
        let completedReps = 0;
        let timerInterval = null;
        let isPaused = true;
        let totalDurationSeconds = 0;
        let remainingDurationSeconds = 0;
        
        const startSynth = new Tone.Synth().toDestination();
        const finishSynth = new Tone.Synth().toDestination();
        function playStartSound(){ startSynth.triggerAttackRelease("C4", "8n"); }
        function playFinishSound(){ finishSynth.triggerAttackRelease("C5", "8n"); }
        function playCountdownSound(){ startSynth.triggerAttackRelease("A3", "16n"); }
        
        function calculateTotalDuration() {
            let total = 0;
            exercises.forEach(ex=>{
                if(ex.type==='reps') total += ex.reps*(ex.timePerRep||4.5);
                else total += ex.duration||0;
            });
            return Math.ceil(total);
        }
        
        function formatTime(sec){
            sec = Math.max(0, sec);
            const m = Math.floor(sec/60);
            const s = Math.floor(sec%60);
            return m>0 ? `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}` : `${s}s`;
        }
        
        function updateUI(){
            const ex = exercises[currentExerciseIndex];
            exerciseName.textContent = ex.name;
            exerciseImage.src = `img/${ex.imageName}`;
            
            if(ex.type==='reps'){
                exerciseDetails.textContent = `${ex.reps}次`;
                repCounterEl.textContent = `已完成: ${completedReps} / 剩余: ${ex.reps-completedReps}`;
                repCounterEl.classList.remove('hidden');
            }else{
                exerciseDetails.textContent = `${ex.duration}s`;
                repCounterEl.classList.add('hidden');
            }
        
            currentTimerEl.textContent = formatTime(currentExerciseTime);
            remainingTimeEl.textContent = formatTime(remainingDurationSeconds);
            totalTimeEl.textContent = formatTime(totalDurationSeconds);
            exerciseProgressEl.textContent = `${currentExerciseIndex+1} / ${exercises.length}`;
        
            if (currentExerciseIndex + 1 < exercises.length) {
                const nextEx = exercises[currentExerciseIndex + 1];
                nextExerciseEl.textContent = `下一个: ${nextEx.name}`;
            } else {
                nextExerciseEl.textContent = "下一个：完成!";
            }
        }
        
        function startTimer(){
            if(!isPaused) return;
            isPaused = false;
            startPauseBtn.textContent = '⏸';
            playStartSound();
        
            timerInterval = setInterval(()=>{
                if(currentExerciseTime>0){
                    currentExerciseTime--;
                    remainingDurationSeconds--;
                    if(currentExerciseTime<=3 && currentExerciseTime>0) playCountdownSound();
                    
                    const ex = exercises[currentExerciseIndex];
                    if(ex.type==='reps'){
                        completedReps = Math.floor((ex.reps*(ex.timePerRep||4.5)-currentExerciseTime)/(ex.timePerRep||4.5));
                    }
                    updateUI();
                } else {
                    clearInterval(timerInterval);
                    setTimeout(moveToNextExercise, 2000);
                }
            },1000);
        }
        
        function pauseTimer() {
            isPaused = true;
            clearInterval(timerInterval);
            startPauseBtn.textContent = '▶';
        }
        
        function moveToNextExercise() {
            pauseTimer();
        
            const currentEx = exercises[currentExerciseIndex];
            const currentDuration = (currentEx.reps * (currentEx.timePerRep || 4.5)) || currentEx.duration || 0;
            remainingDurationSeconds -= currentDuration;
        
            currentExerciseIndex++;
            completedReps = 0;
        
            if(currentExerciseIndex >= exercises.length){
                playFinishSound();
                currentTimerEl.textContent = "完成!";
                totalTimeEl.textContent = "完成!";
                remainingTimeEl.textContent = "完成!";
                startPauseBtn.textContent = '▶';
                return;
            }
        
            const nextEx = exercises[currentExerciseIndex];
            currentExerciseTime = (nextEx.reps * (nextEx.timePerRep || 4.5)) || nextEx.duration || 20;
            updateUI();
            startTimer();
        }
        
        function moveToPrevExercise(){
            if(currentExerciseIndex===0) return;
            pauseTimer();
        
            const currentEx = exercises[currentExerciseIndex];
            const currentDuration = (currentEx.reps * (currentEx.timePerRep || 4.5)) || currentEx.duration || 0;
            remainingDurationSeconds += currentDuration;
        
            currentExerciseIndex--;
            completedReps = 0;
        
            const prevEx = exercises[currentExerciseIndex];
            currentExerciseTime = (prevEx.reps * (prevEx.timePerRep || 4.5)) || prevEx.duration || 20;
            remainingDurationSeconds += currentExerciseTime;
        
            updateUI();
            startTimer();
        }
        
        function resetWorkout(){
            pauseTimer();
            currentExerciseIndex = 0;
            completedReps = 0;
            totalDurationSeconds = calculateTotalDuration();
            remainingDurationSeconds = totalDurationSeconds;
            const firstEx = exercises[0];
            currentExerciseTime = (firstEx.reps * (firstEx.timePerRep || 4.5)) || firstEx.duration || 20;
            startPauseBtn.textContent = '▶';
            updateUI();
        }
        
        startPauseBtn.addEventListener('click', ()=>{
            if(currentExerciseIndex >= exercises.length){
                resetWorkout();
            } else if(isPaused){
                startTimer();
            } else {
                pauseTimer();
            }
        });
        
        nextBtn.addEventListener('click', moveToNextExercise);
        prevBtn.addEventListener('click', moveToPrevExercise);
        
        window.onload = function(){
            totalDurationSeconds = calculateTotalDuration();
            remainingDurationSeconds = totalDurationSeconds;
            const firstEx = exercises[0];
            currentExerciseTime = (firstEx.reps * (firstEx.timePerRep || 4.5)) || firstEx.duration || 20;
          
            updateUI();
            // startPauseBtn.textContent = '▶';
        };
    </script>
</body>
</html>